{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>AIS - A.I Interview Simulator</title>

    <!-- jQuery Import -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Bootstrap core CSS -->
    <link href='{%static "vendor/bootstrap/css/bootstrap.min.css" %}' rel="stylesheet">
    <link href="//cdnjs.cloudflare.com/ajax/libs/animate.css/3.2.0/animate.min.css" rel="stylesheet">

    <!-- Custom fonts for this template -->
    <link href='{%static "vendor/font-awesome/css/font-awesome.min.css" %}' rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>

    <!-- Custom styles for this template -->
    <link href='{%static "css/trainingOnAir.css" %}' rel="stylesheet">
    
    <script>
        var ques_id = {{ ques_id | safe }};
        var ques_text = {{ ques_text | safe}};
    </script>
    
    <link href='{%static "css/agency.min.css" %}' rel="stylesheet">
    <script src='{%static "js/realtimeface.js"%}'></script>
    <script src='{%static "js/stt.js" %}'></script>

    <script>
        getKey();
        var tip = {{ tip | safe}};
        function errorToast() {
            $.notify({
                // options
                icon: 'glyphicon glyphicon-tag',
                title: '<strong> ERROR: </strong>',
                message: '얼굴 인식에 실패했습니다.',
            }, {
                    // settings
                    element: 'body',
                    position: null,
                    type: "danger",
                    allow_dismiss: true,
                    newest_on_top: false,
                    showProgressbar: false,
                    placement: {
                        from: "bottom",
                        align: "right"
                    },
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
                    delay: 500,
                    timer: 1000,
                    mouse_over: null,
                    animate: {
                        enter: 'animated fadeInDown',
                        exit: 'animated fadeOutUp'
                    },
                });
        }
        function tipToast(count) {
				document.getElementById("textTitle").textContent = "면접 TIP";
				document.getElementById("question").textContent = tip[count];
        }
        function banPoseToast() {
            $.notify({
                // options
                icon: 'glyphicon glyphicon-exclamation-sign',
                title: '<strong>탐지:</strong>',
                message: "고개가 기울어진 것은 좋지 않아요!",
            }, {
                    // settings
                    element: 'body',
                    position: null,
                    type: "warning",
                    allow_dismiss: true,
                    newest_on_top: false,
                    showProgressbar: false,
                    placement: {
                        from: "bottom",
                        align: "left"
                    },
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
                    delay: 5000,
                    timer: 1000,
                    mouse_over: null,
                    animate: {
                        enter: 'animated fadeInDown',
                        exit: 'animated fadeOutUp'
                    }
                });
        }
        function banEmotionToast(Emotion) {
            $.notify({
                // options
                icon: 'glyphicon glyphicon-exclamation-sign',
                title: '<strong>탐지:</strong>',
                message: "'" + Emotion + "' 표정이 탐지되었어요",
            }, {
                    // settings
                    element: 'body',
                    position: null,
                    type: "warning",
                    allow_dismiss: true,
                    newest_on_top: false,
                    showProgressbar: false,
                    placement: {
                        from: "bottom",
                        align: "right"
                    },
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
                    delay: 5000,
                    timer: 1000,
                    mouse_over: null,
                    animate: {
                        enter: 'animated fadeInDown',
                        exit: 'animated fadeOutUp'
                    }
                });
        }
        function banWordToast(word) {
            $.notify({
                // options
                icon: 'glyphicon glyphicon-exclamation-sign',
                title: '<strong>탐지:</strong>',
                message: "'" + word + "' 단어가 탐지되었어요",
            }, {
                    // settings
                    element: 'body',
                    position: null,
                    type: "warning",
                    allow_dismiss: true,
                    newest_on_top: false,
                    showProgressbar: false,
                    placement: {
                        from: "bottom",
                        align: "right"
                    },
                    offset: 20,
                    spacing: 10,
                    z_index: 1031,
                    delay: 5000,
                    timer: 1000,
                    mouse_over: null,
                    animate: {
                        enter: 'animated tada',
                        exit: 'animated fadeOutUp'
                    }
                });
        }
		
        var banWordList = [];
        var banWordCount=[];
        var final_transcript = "";

        function startSpeechToText() {
            final_transcript = "";
            annyang.start({
                autoRestart: true,
                continuous: false
            });
            var recognition = annyang.getSpeechRecognizer();
            recognition.interimResults = true;
            recognition.onresult = function (event) {
                var interim_transcript = '';
                final_transcript = '';
                for (var i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        final_transcript += event.results[i][0].transcript;
                        var banLength = banWordList.length;
                        for (var j = 0; j < banLength; j++) {
                            if (event.results[i][0].transcript.indexOf(banWordList[j]) != -1) {
                                banWordToast(banWordList[j]);
                                var final_transcript_words = final_transcript.split(banWordList[j]);
                                banWordCount[j]+=final_transcript_words.length-1;
                            }
                        }
                    }
                }
            };
        }

        function stopSpeechToText() {
            annyang.abort();
        }

    </script>
</head>

<body id="page-top">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg" style="height: 75px;background-color: rgb(44,62,80); text-transform: none" id="mainNav">
        <div class="container">
            <a class="navbar-brand js-scroll-trigger" href="/interviews/" style="color: white;">AIS</a>
            <button class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded" type="button" data-toggle="collapse"
                data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                Menu
                <i class="fa fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive" style="background-color: rgb(44,62,80);">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item mx-0 mx-lg-1">
                        <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/interviews/training/hw-check/">Practice</a>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1">
                        <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/interviews/test/hw-check/">Test</a>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1">
                        <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/interviews/record">Record</a>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1">
                        <a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/member/logout/">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"
        crossorigin="anonymous">

    <div id="mySidenav" class="sidenav" style="background-color: rgba(255,255,255,1); width: inherit;">
        <a href="javascript:void(0)" class="closebtn" onclick="nav()">&times;</a>
        
        <hr style="margin-bottom: -5px; border: 0.5px solid;">
        
        <!-- Emotion Control Section -->
        <div class="mid" id="emotionControl" style="height: 350px; padding: 10px;">
            <div class="container2">
                <a style="font-size: 24px; font-weight: bold;"> &nbsp; &nbsp;감정 ON / OFF</a>

                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkAnger">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">분노</a>
                </div>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkContempt">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">경멸</a>
                </div>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkDisgust">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">싫음</a>
                </div>
                <br>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkFear">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">공포</a>
                </div>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkHappiness">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">행복</a>
                </div>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkNeutral">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">중립</a>
                </div>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkSadness">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">슬픔</a>
                </div>
                <div id="emotion">
                    <label class="switch">
                        <input type="checkbox" id="checkSurprise">
                        <span class="slider"></span>
                    </label>
                    <a style="font-size: 18px; font-weight: bold; margin-left: -10px; max-width: 80px">놀람</a>
                </div>
            </div>
        </div>
        <br>
        
        <hr style="margin-top: -10px; border: 0.5px solid;">

        <!-- Ban Wrod Section -->
        <div class="mid">
            <div class="banword">
                <a style="font-size: 24px; font-weight: bold;">금지 단어</a>
				<br>

                <div>
                    <input id="word" type="text" style="width: 160px; margin-right: -5px; border: 1px solid; border-top-left-radius: 5px;border-bottom-left-radius: 5px;"
                    />
                    <button style="border: 1px solid; border-bottom-right-radius: 5px; border-top-right-radius: 5px;" onclick="add();"> 추가 </button>
                </div>

                <br><br>

                <ul class="list-group mid" id="ban-word" style="width: 280px;">
                </ul>

                <br><br>
                <button type="button" class="btn btn-primary" onclick="reset()">초기화</button>
                <hr style="border: 0.5px solid;">
            </div>
        </div>
    </div>

    <div class="left-section mid">
    	<div class="mid clip" id="clip">
    		<div id="text" style="padding: 10px; width: 350px">
    			<p id="textTitle" style="font-size: 32px; text-align: center"> 면접 질문 </p>
    			<br><br>
    			<p id="question" style="font-size: 24px; text-align: center"> 면접이 시작되면 <br> 질문이 표시됩니다. </p>
    		</div>	
    	</div>
    </div>

    <div class="middle-section">
        <div class="mid" style="margin-top: 50px;">
            <video style="border: 1px solid black; align-items: center;" id="webCam" width="660" height="495" autoplay muted></video>
            <canvas id="snapshot" width="660" height="495" style="display: none;"></canvas>
        </div>
        <div class="mid">
            <br>
            <button type="button" id="setting" class="btn btn-danger" onclick="nav();">환경 설정 ON</button>
            <button type="button" id="record" class="btn btn-primary" disabled>면접 시작</button>
            <button type="button" id="finInterview" class="btn btn-success" style="display: none;" onclick="getTrainingResult(banWordList,banWordCount,banEmotionList,banEmotionCount)" disabled>연습 종료</button>
            <a id="timer">&nbsp;00:00&nbsp;</a>
        </div>
    </div>

    <div class="right-section mid">
        <div id="emotionresult">
            <div id="emotiontitle">
                <span>실시간 감정</span>
            </div>
            
            <div class="emoticon" id="emoticon1">
                <img id="anger" src='{%static "img/emoticon/a4.png"%}'>
                <img id="contempt" src='{%static "img/emoticon/c4.png"%}'>
                <img id="disgust" src='{%static "img/emoticon/d4.png"%}'>
                <img id="fear" src='{%static "img/emoticon/f4.png"%}'>
                <p id="emoticon-name"> &nbsp; &nbsp;분노 &nbsp; &nbsp; 경멸 &nbsp; &nbsp; &nbsp;싫음 &nbsp; &nbsp; 공포 </p>
            </div>

            <div class="emoticon" id ="emoticon2">
                <img id="happiness" src='{%static "img/emoticon/h4.png"%}'>
                <img id="neutral" src='{%static "img/emoticon/n4.png"%}'>
                <img id="sadness" src='{%static "img/emoticon/s4.png"%}'>
                <img id="surprise" src='{%static "img/emoticon/p4.png"%}'>
                <p id="emoticon-name"> &nbsp; &nbsp;행복 &nbsp; &nbsp; 중립 &nbsp; &nbsp; &nbsp;슬픔 &nbsp; &nbsp; 놀람 </p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div style="text-align: center;">
        <div class="footer-section">
            <br>
            <a id="footer-title">Copyright</a>
            <br><br>
            <a id="footer-content">&copy; 2018 Human Learning. &nbsp; All Rights Reserved </a>
        </div>
        
        <div class="footer-section">
            <br>
            <a id="footer-title">About Us&nbsp; </a>
            <br><br>
            <a href="https://github.com/daegweon/ai_interview_simulator">
                <i style="color: white; font-size:30px" class="fa">&#xf09b;</i>
            </a>
            <a> &nbsp; &nbsp; </a>
            <a>
                <i style="color: white; font-size:30px;" class="fa">&#xf08c;</i>
            </a>
            <a> &nbsp; &nbsp; </a>
            <a href="#">
                <i style="color: white; font-size:30px;" class="fa">&#xf0d5;</i>
            </a>
        </div>
        
        <div class="footer-section">
            <br>
            <a id="footer-title">Contact Us&nbsp; </a>
			<br><br>
            <a id="footer-content">quwieo@ajou.ac.kr</a>
        </div>
    </div>

    <script>
        function nav() {
            var navBtn = document.querySelector('button#setting');

            if (navBtn.textContent == '환경 설정 ON') {
                openNav();
                navBtn.textContent = '환경 설정 OFF';
            }
            else if (navBtn.textContent == '환경 설정 OFF') {
                closeNav();
                navBtn.textContent = '환경 설정 ON';
            }
        }

        /* Set the width of the side navigation to ???px */
        function openNav() {
            document.getElementById("mySidenav").style.width = "310px";
        }

        /* Set the width of the side navigation to 0 */
        function closeNav() {
            document.getElementById("mySidenav").style.width = "0";
        }
    </script>
   
    <script>
        $(document).ready(function () {
            $("#word").keypress(function (e) {
                if (e.which == 13) {
                    add();  // 실행할 이벤트
                }
            });
        });
        
        var btnCount = 1;

        function add() {
            var word = $("#word").val();
            var li = document.createElement("li");
            li.className = "list-group-item";
            li.style = "width: 80%";
            li.id = "word" + btnCount;
            li.innerHTML = word;
            banWordList.push(word);
            $("#ban-word").append(li)
            $("#word").val("");
            var len = banWordList.length;
            banWordCount[len-1]=0;
        }

        function reset() {
            $("#ban-word").empty();
            btnCount = 1;
            banWordList = [];
            banWordCount = [];
        }
    </script>

    <!-- Bootstrap core JavaScript -->
    <script src='{%static "vendor/jquery/jquery.min.js" %}'></script>
    <script src='{%static "vendor/bootstrap/js/bootstrap.bundle.min.js" %}'></script>

    <!-- Plugin JavaScript -->
    <script src='{%static "vendor/jquery-easing/jquery.easing.min.js" %}'></script>

    <!-- Custom scripts for this template -->
    <script src='{%static "js/agency.min.js" %}'></script>
    <script src='{%static "js/interviewTraining.js" %}'></script>
    <script src='{%static "js/bootstrap-notify.js"%}'></script>

</body>

</html>